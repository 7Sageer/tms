!function(e,t,n,r){"use strict";var i=function(e,t,n){var r;return function(){if(r){if(!n)return;clearTimeout(r)}var i=this,o=arguments;r=setTimeout(function(){r=null,e.apply(i,o)},t)}},o=function(t,n,r,i){t.addEventListener?t.addEventListener(n,r,i?!0:!1):t.attachEvent?t.attachEvent("on"+n,r):t!=e&&(t["on"+n]=r)},a=function(t,n,r,i){t.removeEventListener?t.removeEventListener(n,r,i?!0:!1):t.detachEvent?t.detachEvent("on"+n,r):t!=e&&(t["on"+n]=null)},l=function(e,n,i,o){if(t.createEvent){var a=t.createEvent("Event");a.initEvent(n,i!==r?i:!0,o!==r?o:!1),e.dispatchEvent(a)}else if(t.createEventObject){var a=t.createEventObject();e.fireEvent("on"+n,a)}else"function"==typeof e["on"+n]&&e["on"+n]()},u=function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!1},f="undefined"!=typeof Node?Node.ELEMENT_NODE:1,c="undefined"!=typeof Node?Node.TEXT_NODE:3,s=function(e,t){for(var n=t;n;){if(n===e)return!0;n=n.parentNode}return!1},d=function(e,t){if(e.firstChild)return e.firstChild;for(;e;){if(e==t)return null;if(e.nextSibling)return e.nextSibling;e=e.parentNode}return null},g=function(n){if(e.getSelection){var r=e.getSelection();if(r.rangeCount>0)return r.getRangeAt(0)}else if(t.selection){var r=t.selection;return r.createRange()}return null},p=function(n,r){if(r)if(e.getSelection){var i=e.getSelection();i.removeAllRanges(),i.addRange(r)}else t.selection&&r.select()},v=function(){if(e.getSelection){var n=e.getSelection();if(!n.rangeCount)return!1;var r=n.getRangeAt(0).cloneRange();if(r.getBoundingClientRect){var i=r.getBoundingClientRect();if(i&&i.left&&i.top&&i.right&&i.bottom)return{left:parseInt(i.left),top:parseInt(i.top),width:parseInt(i.right-i.left),height:parseInt(i.bottom-i.top)};for(var o=r.getClientRects?r.getClientRects():[],a=0;a<o.length;++a){var i=o[a];if(i.left&&i.top&&i.right&&i.bottom)return{left:parseInt(i.left),top:parseInt(i.top),width:parseInt(i.right-i.left),height:parseInt(i.bottom-i.top)}}}}else if(t.selection){var n=t.selection;if("Control"!=n.type){var r=n.createRange();if(r.boundingLeft||r.boundingTop||r.boundingWidth||r.boundingHeight)return{left:r.boundingLeft,top:r.boundingTop,width:r.boundingWidth,height:r.boundingHeight}}}return!1},h=function(n){if(e.getSelection){var r=e.getSelection();return r.isCollapsed?!0:!1}if(t.selection){var r=t.selection;if("Text"==r.type){var i=t.selection.createRange(),o=t.body.createTextRange();return o.moveToElementText(n),o.setEndPoint("EndToStart",i),0==i.htmlText.length}if("Control"==r.type)return!1}return!0},m=function(n){if(e.getSelection){var r=e.getSelection();if(!r.rangeCount)return[];for(var i=[],o=0;o<r.rangeCount;++o)for(var a=r.getRangeAt(o),l=a.startContainer,u=a.endContainer;l;){if(l!=n){var c=!1;if(r.containsNode)c=r.containsNode(l,!0);else{var g=t.createRange();g.selectNodeContents(l);for(var o=0;o<r.rangeCount;++o){var a=r.getRangeAt(o);if(a.compareBoundaryPoints(a.END_TO_START,g)>=0&&a.compareBoundaryPoints(a.START_TO_END,g)<=0){c=!0;break}}}c&&i.push(l)}l=d(l,l==u?u:n)}return 0==i.length&&s(n,r.focusNode)&&r.focusNode!=n&&i.push(r.focusNode),i}if(t.selection){var r=t.selection;if("Text"==r.type){for(var i=[],p=r.createRangeCollection(),o=0;o<p.length;++o)for(var a=p[o],v=a.parentElement(),l=v;l;){var g=a.duplicate();if(g.moveToElementText(l.nodeType!=f?l.parentNode:l),g.compareEndPoints("EndToStart",a)>=0&&g.compareEndPoints("StartToEnd",a)<=0){for(var h=!1,m=0;m<i.length;++m)if(i[m]===l){h=!0;break}h||i.push(l)}l=d(l,v)}return 0==i.length&&s(n,t.activeElement)&&t.activeElement!=n&&i.push(t.activeElement),i}if("Control"==r.type){for(var i=[],a=r.createRange(),o=0;o<a.length;++o)i.push(a(o));return i}}return[]},T=function(){if(e.getSelection){var n=e.getSelection();if(!n.isCollapsed)try{n.collapseToEnd()}catch(r){}}else if(t.selection){var n=t.selection;if("Control"!=n.type){var i=n.createRange();i.collapse(!1),i.select()}}},y=function(n,r,i){if(e.getSelection){var o=e.getSelection();if(o.modify){for(var a=0;r>a;++a)o.modify("extend","backward","character");for(var a=0;i>a;++a)o.modify("extend","forward","character")}else{var l=o.getRangeAt(0);l.setStart(l.startContainer,l.startOffset-r),l.setEnd(l.endContainer,l.endOffset+i),o.removeAllRanges(),o.addRange(l)}}else if(t.selection){var o=t.selection;if("Control"!=o.type){var l=o.createRange();l.collapse(!0),l.moveStart("character",-r),l.moveEnd("character",i),l.select()}}},E=function(n){if(h(n))return null;if(e.getSelection){var r=e.getSelection();if(r.rangeCount){for(var i=t.createElement("div"),o=r.rangeCount,a=0;o>a;++a){var l=r.getRangeAt(a).cloneContents();i.appendChild(l)}return i.innerHTML}}else if(t.selection){var r=t.selection;if("Text"==r.type){var u=r.createRange();return u.htmlText}}return null},C=function(n,r){if(e.getSelection){var i=e.getSelection();if(s(n,i.anchorNode)&&s(n,i.focusNode))return!0;if(!r)return!1;var o=t.createRange();o.selectNodeContents(n),o.collapse(!1),i.removeAllRanges(),i.addRange(o)}else if(t.selection){var i=t.selection;if("Control"==i.type){var o=i.createRange();if(0!=o.length&&s(n,o(0)))return!0}else{var a=t.body.createTextRange();a.moveToElementText(n);var o=i.createRange();if(a.inRange(o))return!0}if(!r)return!1;var o=t.body.createTextRange();o.moveToElementText(n),o.setEndPoint("StartToEnd",o),o.select()}return!0},b=function(n,r){if(e.getSelection){var i=e.getSelection();if(i.getRangeAt&&i.rangeCount){var o=i.getRangeAt(0),a=t.createElement("div");a.innerHTML=r;for(var l,u,f=t.createDocumentFragment();l=a.firstChild;)u=f.appendChild(l);s(n,o.commonAncestorContainer)?(o.deleteContents(),o.insertNode(f)):n.appendChild(f),u&&(o=o.cloneRange(),o.setStartAfter(u),o.collapse(!0),i.removeAllRanges(),i.addRange(o))}}else if(t.selection){var i=t.selection;if("Control"!=i.type){var c=i.createRange();c.collapse(!0);var o=i.createRange();if(s(n,o.parentElement()))o.pasteHTML(r);else{var d=t.body.createTextRange();d.moveToElementText(n),d.collapse(!1),d.select(),d.pasteHTML(r)}o=i.createRange(),o.setEndPoint("StartToEnd",c),o.select()}}};e.wysiwyg=function(r){r=r||{};var R=r.element||null;"string"==typeof R&&(R=t.getElementById(R));var S=r.onKeyDown||null,L=r.onKeyPress||null,N=r.onKeyUp||null,x=r.onSelection||null,M=r.onPlaceholder||null,I=r.onClosepopup||null,w=r.hijackContextmenu||!1,H="TEXTAREA"==R.nodeName||"INPUT"==R.nodeName;if(H){var k="contentEditable"in t.body;if(k){var A=n.userAgent.match(/(?:iPad|iPhone|Android).* AppleWebKit\/([^ ]+)/);A&&420<=parseInt(A[1])&&parseInt(A[1])<534&&(k=!1)}if(!k){var P=R,O=function(e){return e.replace(/<br[ \/]*>\n?/gi,"<br>\n")};P.value=O(P.value);var D=function(){return this},B=function(){return null};return{legacy:!0,getElement:function(){return P},getHTML:function(){return P.value},setHTML:function(e){return P.value=O(e),this},getSelectedHTML:B,sync:D,collapseSelection:D,expandSelection:D,openPopup:B,closePopup:D,removeFormat:D,bold:D,italic:D,underline:D,strikethrough:D,forecolor:D,highlight:D,fontName:D,fontSize:D,subscript:D,superscript:D,align:D,format:D,indent:D,insertLink:D,insertImage:D,insertHTML:D,insertList:D}}}var P=null,j=null;if(H){P=R,P.style.display="none",j=t.createElement("DIV"),j.innerHTML=P.value;var K=P.parentNode,X=P.nextSibling;X?K.insertBefore(j,X):K.appendChild(j)}else j=R;j.setAttribute("contentEditable","true");var W=t.all&&!t.addEventListener?t:e,Y=null;if(H){var _=j.innerHTML;Y=function(){var e=j.innerHTML;e!=_&&(P.value=e,_=e,l(P,"change",!1))}}var F;if(M){var V=!1;F=function(){for(var e=!0,t=j;t;)if(t=d(t,j)){if(t.nodeType==f){if("IMG"==t.nodeName){e=!1;break}}else if(t.nodeType==c){var n=t.nodeValue;if(n&&-1!=n.search(/[^\s]/)){e=!1;break}}}else;V!=e&&(M(e),V=e)},F()}var q=null,z=null,U=null;x&&(z=function(t,n,r){var i=h(j),o=m(j),a=null===t||null===n?null:{left:t,top:n,width:0,height:0},l=v();if(l&&(a=l),a){if(j.getBoundingClientRect){var u=j.getBoundingClientRect();a.left-=parseInt(u.left),a.top-=parseInt(u.top)}else{var c=j,s=0,d=0,g=!1;do s+=c.offsetLeft?parseInt(c.offsetLeft):0,d+=c.offsetTop?parseInt(c.offsetTop):0,"fixed"==c.style.position&&(g=!0);while(c=c.offsetParent);a.left-=s-(g?0:e.pageXOffset),a.top-=d-(g?0:e.pageYOffset)}a.left<0&&(a.left=0),a.top<0&&(a.top=0),a.width>j.offsetWidth&&(a.width=j.offsetWidth),a.height>j.offsetHeight&&(a.height=j.offsetHeight)}else if(o.length)for(var p=0;p<o.length;++p){var c=o[p];if(c.nodeType==f){a={left:c.offsetLeft,top:c.offsetTop,width:c.offsetWidth,height:c.offsetHeight};break}}x(i,a,o,r)},U=i(z,1));var G=null,J=function(t){if(!t)var t=e.event;var n=t.target||t.srcElement;n.nodeType==c&&(n=n.parentNode),s(G,n)||Z()},Q=function(){if(G)return G;o(W,"mousedown",J,!0),G=t.createElement("DIV");var e=j.parentNode,n=j.nextSibling;return n?e.insertBefore(G,n):e.appendChild(G),G},Z=function(){G&&(G.parentNode.removeChild(G),G=null,a(W,"mousedown",J,!0),I&&I())};o(j,"focus",function(){P&&l(P,"focus",!1)}),o(j,"blur",function(){Y&&Y(),P&&l(P,"blur",!1)});var $=null;if(F||Y){var ee=Y?i(Y,250,!0):null,te=function(e){F&&F(),ee&&ee()};$=i(te,1),o(j,"input",$),o(j,"DOMNodeInserted",$),o(j,"DOMNodeRemoved",$),o(j,"DOMSubtreeModified",$),o(j,"DOMCharacterDataModified",$),o(j,"propertychange",$),o(j,"textInput",$),o(j,"paste",$),o(j,"cut",$),o(j,"drop",$)}var ne=function(t,n){if(!t)var t=e.event;var r=t.which||t.keyCode,i=String.fromCharCode(r||t.charCode),o=t.shiftKey||!1,a=t.altKey||!1,l=t.ctrlKey||!1,f=t.metaKey||!1;if(1==n){if(S&&S(r,i,o,a,l,f)===!1)return u(t)}else if(2==n){if(L&&L(r,i,o,a,l,f)===!1)return u(t)}else if(3==n&&N&&N(r,i,o,a,l,f)===!1)return u(t);if((2==n||3==n)&&(q=null,U&&U(null,null,!1)),2==n&&$)switch(r){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:break;default:$()}};o(j,"keydown",function(e){return ne(e,1)}),o(j,"keypress",function(e){return ne(e,2)}),o(j,"keyup",function(e){return ne(e,3)});var re=function(t,n){if(!t)var t=e.event;var r=null,i=null;t.clientX&&t.clientY?(r=t.clientX,i=t.clientY):t.pageX&&t.pageY&&(r=t.pageX-e.pageXOffset,i=t.pageY-e.pageYOffset),t.which&&3==t.which?n=!0:t.button&&2==t.button&&(n=!0),a(W,"mouseup",re),q=null,(w||!n)&&U&&U(r,i,n)};o(j,"mousedown",function(e){a(W,"mouseup",re),o(W,"mouseup",re)}),o(j,"mouseup",function(e){re(e),$&&$()}),o(j,"dblclick",function(e){re(e)}),o(j,"selectionchange",function(e){re(e)}),w&&o(j,"contextmenu",function(e){return re(e,!0),u(e)});var ie=function(n,r,i){if(p(j,q),!C(j,i))return!1;if(e.getSelection)try{return t.queryCommandSupported&&!t.queryCommandSupported(n)?!1:t.execCommand(n,!1,r)}catch(o){}else if(t.selection){var a=t.selection;if("None"!=a.type){var l=a.createRange();try{return l.queryCommandEnabled(n)?l.execCommand(n,!1,r):!1}catch(o){}}}return!1},oe=null,ae=function(){(t.all||e.MSInputMethodContext)&&(oe=t.createElement("DIV"),j.appendChild(oe))},le=function(e){oe&&(j.removeChild(oe),oe=null),$&&$(),e?(T(),q=null):q&&(q=g(j))};return{getElement:function(){return j},getHTML:function(){return j.innerHTML},setHTML:function(e){return j.innerHTML=e,le(!0),this},getSelectedHTML:function(){return p(j,q),C(j)?E(j):null},sync:function(){return Y&&Y(),this},collapseSelection:function(){return T(),q=null,this},expandSelection:function(e,t){return p(j,q),C(j)?(y(j,e,t),q=g(j),this):this},openPopup:function(){return q||(q=g(j)),Q()},closePopup:function(){return Z(),this},removeFormat:function(){return ie("removeFormat"),ie("unlink"),le(),this},bold:function(){return ie("bold"),le(),this},italic:function(){return ie("italic"),le(),this},underline:function(){return ie("underline"),le(),this},strikethrough:function(){return ie("strikeThrough"),le(),this},forecolor:function(e){return ie("foreColor",e),le(),this},highlight:function(e){return ie("hiliteColor",e)||ie("backColor",e),le(),this},fontName:function(e){return ie("fontName",e),le(),this},fontSize:function(e){return ie("fontSize",e),le(),this},subscript:function(){return ie("subscript"),le(),this},superscript:function(){return ie("superscript"),le(),this},align:function(e){return ae(),"left"==e?ie("justifyLeft"):"center"==e?ie("justifyCenter"):"right"==e?ie("justifyRight"):"justify"==e&&ie("justifyFull"),le(),this},format:function(e){return ae(),ie("formatBlock",e),le(),this},indent:function(e){return ae(),ie(e?"outdent":"indent"),le(),this},insertLink:function(e){return ie("createLink",e),le(!0),this},insertImage:function(e){return ie("insertImage",e,!0),le(!0),this},insertHTML:function(e){return ie("insertHTML",e,!0)||(p(j,q),C(j,!0),b(j,e)),le(!0),this},insertList:function(e){return ae(),ie(e?"insertOrderedList":"insertUnorderedList"),le(),this}}}}(window,document,navigator);
!function(t,e,n,a){"use strict";var r=function(t,e,n){var a,r,o,i,s,l,c,p;switch(i=Math.floor(6*t),s=6*t-i,l=n*(1-e),c=n*(1-s*e),p=n*(1-(1-s)*e),i%6){case 0:a=n,r=p,o=l;break;case 1:a=c,r=n,o=l;break;case 2:a=l,r=n,o=p;break;case 3:a=l,r=c,o=n;break;case 4:a=p,r=l,o=n;break;case 5:a=n,r=l,o=c}var u=Math.floor(255*a).toString(16),f=Math.floor(255*r).toString(16),d=Math.floor(255*o).toString(16);return"#"+(u.length<2?"0":"")+u+(f.length<2?"0":"")+f+(d.length<2?"0":"")+d},o=function(t){return t.replace(/[&<>"]/g,function(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};return e[t]||t})},i=function(a,i,s,l,c,p,u,f,d,h,w,g,y,v,m,b,C){var P=function(t,e){e&&(t.getSelectedHTML()?t.insertLink(e):t.insertHTML('<a href="'+o(e)+'">'+o(e)+"</a>")),t.closePopup().collapseSelection()},k=function(t,e){var a=T(p),r=n('<input type="text" value="'+(e?e.attr("href"):"")+'" />').addClass("wysiwyg-input").keypress(function(n){(10==n.which||13==n.which)&&(e?(e.attr("href",r.val()),t.closePopup().collapseSelection()):P(t,r.val()))});f&&r.attr("placeholder",f);var o=a.click(function(n){return e?(e.attr("href",r.val()),t.closePopup().collapseSelection()):P(t,r.val()),n.stopPropagation(),n.preventDefault(),!1}),i=n("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");return i.append(r).append(o),i},x=function(e){var a=function(t,a){var r='<img id="wysiwyg-insert-image" src="" alt=""'+(a?' title="'+o(a)+'"':"")+" />";e.insertHTML(r).closePopup().collapseSelection();var i=n("#wysiwyg-insert-image").removeAttr("id");h&&i.css({maxWidth:h[0]+"px",maxHeight:h[1]+"px"}).load(function(){i.css({maxWidth:"",maxHeight:""});var t=i.width(),e=i.height();(t>h[0]||e>h[1])&&(t/e>h[0]/h[1]?(e=parseInt(e/t*h[0]),t=h[0]):(t=parseInt(t/e*h[1]),e=h[1]),i.attr("width",t).attr("height",e))}),i.attr("src",t)},r=n("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on"),i=null,s=n('<input type="file" />').css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"});if(!g&&t.File&&t.FileReader&&t.FileList){var l=function(t){if(t.type.match("image.*")){var e=new FileReader;e.onload=function(e){var n=e.target.result;a(n,t.name)},e.readAsDataURL(t)}};i=s.attr("draggable","true").change(function(t){for(var e=t.target.files,n=0;n<e.length;++n)l(e[n])}).on("dragover",function(t){return t.originalEvent.dataTransfer.dropEffect="copy",t.stopPropagation(),t.preventDefault(),!1}).on("drop",function(t){for(var e=t.originalEvent.dataTransfer.files,n=0;n<e.length;++n)l(e[n]);return t.stopPropagation(),t.preventDefault(),!1})}else if(w){var c=s.change(function(t){w.call(this,a)});i=n("<form/>").append(c)}i&&n("<div/>").addClass("wysiwyg-browse").html(u).append(i).appendTo(r);var d=T(p),y=n('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(t){(10==t.which||13==t.which)&&a(y.val())});f&&y.attr("placeholder",f);var v=d.click(function(t){return a(y.val()),t.stopPropagation(),t.preventDefault(),!1});return r.append(n("<div/>").append(y).append(v)),r},L=function(t){var e=function(e,a){e=n.trim(e||""),a=n.trim(a||"");var r=!1;e.length&&!a.length?r=e:-1==a.indexOf("<")&&-1==a.indexOf(">")&&a.match(/^(?:https?:\/)?\/?(?:[^:\/\s]+)(?:(?:\/\w+)*\/)(?:[\w\-\.]+[^#?\s]+)(?:.*)?(?:#[\w\-]+)?$/)&&(r=a),r&&y&&(a=y(r)||""),!a.length&&r&&(a='<video src="'+o(r)+'" />'),t.insertHTML(a).closePopup().collapseSelection()},a=n("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on"),r=n("<textarea>").addClass("wysiwyg-input wysiwyg-inputtextarea");d&&r.attr("placeholder",d),n("<div/>").addClass("wysiwyg-embedcode").append(r).appendTo(a);var i=T(p),s=n('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(t){(10==t.which||13==t.which)&&e(s.val())});f&&s.attr("placeholder",f);var l=i.click(function(t){return e(s.val(),r.val()),t.stopPropagation(),t.preventDefault(),!1});return a.append(n("<div/>").append(s).append(l)),a},S=function(t,e){for(var a=n("<table/>").attr("cellpadding","0").attr("cellspacing","0").attr("unselectable","on"),o=1;15>o;++o){for(var i=n("<tr/>"),s=0;25>s;++s){var l;if(24==s){var c=Math.floor(255/13*(14-o)).toString(16),p=(c.length<2?"0":"")+c;l="#"+p+p+p}else{var u=s/24,f=8>=o?o/8:1,d=o>8?(16-o)/8:1;l=r(u,f,d)}n("<td/>").addClass("wysiwyg-toolbar-color").attr("title",l).attr("unselectable","on").css({backgroundColor:l}).click(function(){var n=this.title;return e?t.forecolor(n).closePopup().collapseSelection():t.highlight(n).closePopup().collapseSelection(),!1}).appendTo(i)}a.append(i)}return a},I=function(t,e){switch(t){case"insertimage":return e?function(t){e(x(K),t)}:null;case"insertvideo":return e?function(t){e(L(K),t)}:null;case"insertlink":return e?function(t){e(k(K),t)}:null;case"bold":return function(){K.bold()};case"italic":return function(){K.italic()};case"underline":return function(){K.underline()};case"strikethrough":return function(){K.strikethrough()};case"forecolor":return e?function(t){e(S(K,!0),t)}:null;case"highlight":return e?function(t){e(S(K,!1),t)}:null;case"alignleft":return function(){K.align("left")};case"aligncenter":return function(){K.align("center")};case"alignright":return function(){K.align("right")};case"alignjustify":return function(){K.align("justify")};case"subscript":return function(){K.subscript()};case"superscript":return function(){K.superscript()};case"indent":return function(){K.indent()};case"outdent":return function(){K.indent(!0)};case"orderedList":return function(){K.insertList(!0)};case"unorderedList":return function(){K.insertList()};case"removeformat":return function(){K.removeFormat().closePopup().collapseSelection()}}return null},T=function(t){return n("<a/>").addClass("wysiwyg-toolbar-icon").attr("href","#").attr("title",t.title).attr("unselectable","on").append(t.image)},M=function(t,e,a,r){n.each(c,function(o,i){if(i&&!(e===!1&&"showstatic"in i&&!i.showstatic||e===!0&&"showselection"in i&&!i.showselection)){var s;s="click"in i?function(t){i.click(n(t))}:"popup"in i?function(t){var e=a(),o=i.popup(e,n(t));r(e,t,o)}:I(o,function(t,e){var n=a();n.append(t),r(n,e),n.find("input[type=text]:first").focus()});var l;s?l=T(i).click(function(t){return s(t.currentTarget),I(o)&&K.getElement().focus(),t.stopPropagation(),t.preventDefault(),!1}):i.html&&(l=n(i.html)),l&&t.append(l)}})},D=function(a,r,o,i){for(var s=r.get(0),l=s.offsetParent,c={left:0,top:0},p=!1,u=!1,f=a.width(),d=l;d;){c.left+=d.offsetLeft,c.top+=d.offsetTop;var h=n(d);"fixed"==h.css("position")&&(p=!0),"visible"!=h.css("overflow")&&(u=!0),d=d.offsetParent}var w=n(l||e.body);w.append(a),o+=s.offsetLeft,i+=s.offsetTop,(p||u)&&(o+f>w.width()-1&&(o=w.width()-f-1),1>o&&(o=1));var g=n(t).width();c.left+o+f>g-1&&(o=g-c.left-f-1);var y=p?0:n(t).scrollLeft();c.left+o<y+1&&(o=y-c.left+1),a.css({left:parseInt(o)+"px",top:parseInt(i)+"px"})},E={},H=null,U=function(t,e,a){var r=function(t,e,a,r,o,i,l){if(C){var c=H||"";switch(e){case 8:c=c.substring(0,c.length-1);case 13:case 27:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:if(t)return;a=!1;break;default:if(!t)return;c+=a}var p=C(c,e,a,r,o,i,l);if("object"!=typeof p||!p.length)return s.closePopup(),H=null,p;var u=n(s.openPopup());u.hide().addClass("wysiwyg-popup wysiwyg-popuphover").empty().append(p),H=c}},o={element:t.get(0),onKeyDown:function(t,e,n,a,o,i){if(v&&v(t,e,n,a,o,i)===!1)return!1;if(e&&!n&&!a&&o&&!i){var s=e.toLowerCase();if(!E[s])return;return E[s](),!1}return r(!1,t,e,n,a,o,i)},onKeyPress:function(t,e,n,a,o,i){return m&&m(t,e,n,a,o,i)===!1?!1:r(!0,t,e,n,a,o,i)},onKeyUp:function(t,e,n,a,r,o){return b&&b(t,e,n,a,r,o)===!1?!1:void 0},onSelection:function(t,a,r,o){var i=!0,c=null;if(t&&n.each(r,function(t,e){return 0!=n(e).parents("a").length?(c=k(s,n(e).parents("a:first")),!1):void 0}),a?c||o||H||("selection"!=l&&"top-selection"!=l&&"bottom-selection"!=l?i=!1:t?i=!1:1==r.length&&"IMG"==r[0].nodeName&&(i=!1)):i=!1,!i)return void s.closePopup();var p,u=function(){var t=p.outerWidth(),r=e.offset(),o=n(s.getElement()).offset(),i=a.left+parseInt(a.width/2)-parseInt(t/2)+o.left-r.left,l=a.top+a.height+o.top-r.top;D(p,e,i,l)};p=n(s.openPopup()),p.hasClass("wysiwyg-popuphover")&&!p.data("special")==!c||(p=n(s.closePopup().openPopup())),H?p.show():p.hasClass("wysiwyg-popup")||(p.addClass("wysiwyg-popup wysiwyg-popuphover"),c?p.empty().append(c).data("special",!0):M(p,!0,function(){return p.empty()},u)),u()},onClosepopup:function(){H=null},hijackContextmenu:"selection"==l};if(a){var i=n("<div/>").addClass("wysiwyg-placeholder").html(a).hide();e.prepend(i),o.onPlaceholder=function(t){t?i.show():i.hide()}}var s=wysiwyg(o);return s},j=n("<div/>").addClass("wysiwyg-container");i&&j.addClass(i),a.wrap(j),j=a.parent(".wysiwyg-container");var F=!1;s&&(F=n("<div/>").addClass("wysiwyg-wrapper").click(function(){K.getElement().focus()}),a.wrap(F),F=a.parent(".wysiwyg-wrapper"));var K=U(a,s?F:j,s);if(K.legacy){var a=n(K.getElement());a.addClass("wysiwyg-textarea"),a.is(":visible")&&a.width(j.width()-(a.outerWidth()-a.width()))}else n(K.getElement()).addClass("wysiwyg-editor");var W={};if(n.each(c,function(t,e){if(e&&e.hotkey){var n=I(t);n&&(E[e.hotkey.toLowerCase()]=n,W[t]=n)}}),"selection"!=l){var A="top"==l||"top-selection"==l,R=n("<div/>").addClass("wysiwyg-toolbar").addClass(A?"wysiwyg-toolbar-top":"wysiwyg-toolbar-bottom");M(R,!1,function(){var t=n(K.openPopup());return t.hasClass("wysiwyg-popup")&&t.hasClass("wysiwyg-popuphover")&&(t=n(K.closePopup().openPopup())),t.hasClass("wysiwyg-popup")||t.addClass("wysiwyg-popup"),t},function(t,e,a){var r=n(e),o=t.outerWidth(),i=r.offset().left-j.offset().left+parseInt(r.width()/2)-parseInt(o/2),s=r.offset().top-j.offset().top;A?s+=r.outerHeight():s-=t.outerHeight(),a&&(i=a.left,s=a.top),D(t,j,i,s)}),A?j.prepend(R):j.append(R)}return{wysiwygeditor:K,$container:j}};n.fn.wysiwyg=function(t,e){if(!t||"object"==typeof t)return t=n.extend({},t),this.each(function(){var e=n(this);if(!e.data("wysiwyg")){var a=t.classes,r=t.placeholder||e.attr("placeholder"),o=!t.toolbar||"top"!=t.toolbar&&"top-selection"!=t.toolbar&&"bottom"!=t.toolbar&&"bottom-selection"!=t.toolbar&&"selection"!=t.toolbar?"top-selection":t.toolbar,s=t.buttons,l=t.submit,c=t.selectImage,p=t.placeholderUrl||null,u=t.placeholderEmbed||null,f=t.maxImageSize||null,d=t.onImageUpload||null,h=t.forceImageUpload&&d,w=t.videoFromUrl||null,g=t.onKeyDown||null,y=t.onKeyPress||null,v=t.onKeyUp||null,m=t.onAutocomplete||null,b=i(e,a,r,o,s,l,c,p,u,f,d,h,w,g,y,v,m);e.data("wysiwyg",b)}});if(1==this.length){var a=this.data("wysiwyg");if(!a)return this;if("container"==t)return a.$container;if("shell"==t)return a.wysiwygeditor}return this}}(window,document,jQuery);