<template>
    <require from="./em-chat-top-menu.css"></require>
    <div class="ui top fixed menu tms-em-chat-top-menu">
        <div ref="chatToDropdownRef" class="ui dropdown link item ${isActiveSearch ? 'tms-hide' : ''} tms-chat-at">
            <span class="text"></span>
            <i class="dropdown icon"></i>
            <div class="menu">
                <div class="ui icon search input">
                    <i class="search icon"></i>
                    <input ref="filterChatToUser" type="text" placeholder="过滤沟通频道|用户">
                </div>
                <div class="divider"></div>
                <div class="header">
                    <i class="filter icon"></i> 切换沟通频道|用户(Ctrl+k)
                </div>
                <div class="scrolling menu">
                    <div class="header">
                        <i class="users icon"></i> 频道 <i ref="createChannelRef" class="circular icon link plus"></i>
                    </div>
                    <a repeat.for="item of channels | sort:'title'" task.bind="initChatToDropdownHandler($last)" href="#/chat/${item.name}" class="item" title="${item.name}" data-value="${item.name}" data-id="${item.name}">
                        <i class="hashtag icon"></i>${item.title}
                    </a>
                    <div class="header">
                        <i class="user icon"></i> 用户
                    </div>
                    <a repeat.for="item of users" task.bind="initChatToDropdownHandler($last)" href="#/chat/@${item.username}" class="item" title="${item.username}" data-value="${item.username}" data-id="@${item.username}">
                        <i style="font-weight: bold;" class="at icon"></i>${item.name}
                    </a>
                </div>
            </div>
        </div>
        <div class="right menu">
            <div show.bind="!!dir" class="item tms-item ${isActiveSearch ? 'tms-hide' : ''}">
                <button click.delegate="showWikiDirHandler()" title="消息目录查看" class="basic ${isRightSidebarShow && (activeType == ACTION_TYPE_DIR) ? 'active' : ''} ui icon button">
                    <i class="unordered list icon"></i>
                </button>
            </div>
            <div class="item tms-item ${isActiveSearch ? 'tms-hide' : ''}">
                <button click.delegate="showAtHandler()" title="@消息查看" class="basic ${isRightSidebarShow && (activeType == ACTION_TYPE_AT) ? 'active' : ''} ui icon button">
                    <i class="at icon"></i>
                    <div show.bind="!!newAtCnt" class="floating ui red empty circular label"></div>
                </button>
            </div>
            <div class="item tms-item ${isActiveSearch ? 'tms-hide' : ''}">
                <button click.delegate="showStowHandler()" title="收藏消息查看" class="basic ${isRightSidebarShow && (activeType == ACTION_TYPE_STOW) ? 'active' : ''} ui icon button">
                    <i class="empty star icon"></i>
                </button>
            </div>
            <div class="item tms-item">
                <button click.delegate="sibebarRightHandler()" title="右侧边栏(Ctrl+.)" class="basic ${isRightSidebarShow ? 'active' : ''} ui icon button">
                    <i class="columns icon"></i>
                </button>
            </div>
            <div class="item">
                <div ref="searchRef" class="ui search">
                    <div class="ui left icon input">
                        <input ref="searchInputRef" keyup.trigger="searchKeyupHandler($event)" blur.trigger="searchBlurHandler()" focus.trigger="searchFocusHandler()" class="prompt" type="text" placeholder="搜索...">
                        <i class="${(searchingP && searchingP.readyState != 4) ? 'spinner loading' : 'search'} icon"></i>
                        <i ref="searchRemoveRef" click.delegate="clearSearchHandler()" class="remove link icon"></i>
                    </div>
                </div>
            </div>
            <div ui-dropdown class="ui top right dropdown item tms-login-user">
                <i class="circular user icon"></i> ${loginUser.name}
                <i class="dropdown icon"></i>
                <div class="menu">
                    <div class="header">账户操作</div>
                    <div class="divider"></div>
                    <a class="item" click.delegate="userEditHandler()"><i class="edit icon"></i>修改</a>
                    <a class="item" click.delegate="logoutHandler()"><i class="sign out icon"></i>退出</a>
                </div>
            </div>
        </div>
    </div>
    <em-user-edit user.bind="loginUser" view-model.ref="userEditMd"></em-user-edit>
    <em-chat-channel-create login-user.bind="loginUser" trigger.bind="createChannelRef"></em-chat-channel-create>
</template>
