<template>
    <require from="./em-blog-content.css"></require>
    <div class="em-blog-content-wrapper">
        <div click.delegate="dimmerHandler()" class="ui inverted dimmer"></div>
        <div show.bind="blog" class="em-blog-content">
            <div class="topbar">
                <div class="ui breadcrumb">
                    <a class="section">TMS博文</a>
                    <div show.bind="blog.space" class="divider"> / </div>
                    <a show.bind="blog.space" class="section active">${blog.space.name}</a>
                    <span if.bind="isSuper || blog.creator.username == loginUser.username" data-tooltip="${blog.privated ? '私有博文,点击可公开' : '公开博文,点击可关闭'}" data-position="right center" style="margin-left: 16px;"><i click.delegate="updatePrivatedHandler()" class="link icon ${blog.privated ? 'lock' : 'unlock alternate'}"></i></span>
                    <span if.bind="(isSuper || blog.creator.username == loginUser.username) && blog.openEdit" data-tooltip="开放编辑中,点击可关闭" data-position="right center" style="margin-left: 8px; top: -1px;"><i click.delegate="openEditHandler()" class="link icon write"></i></span>
                </div>
                <div class="actions">
                    <a if.bind="dir" class="ui basic mini button" title="博文目录 (d)" click.delegate="catalogHandler()">
                        <i class="unordered list icon"></i> 目录
                    </a>
                    <a if.bind="blog.openEdit || isSuper || blog.creator.username == loginUser.username" title="博文编辑 (e | ctrl+dblclick)" class="ui basic mini button" click.delegate="editHandler()">
                        <i class="large icon edit"></i> 编辑
                    </a>
                    <a title="${!blogFollower ? '关注' : '取消关注'}博文更新 (f)" class="ui basic mini button" click.delegate="followerHandler()">
                        <i class="${!blogFollower ? 'unhide' : 'hide'} large icon"></i> ${!blogFollower ? '关注' : '取消'}
                    </a>
                    <em-blog-share view-model.ref="blogShareVm" blog.bind="blog"></em-blog-share>
                    <div ui-dropdown-action class="ui top right pointing dropdown basic mini icon button">
                        <i class="large ellipsis horizontal icon"></i>
                        <div class="menu">
                            <div click.delegate="refreshHandler()" class="item">
                                <i class="refresh icon"></i> 刷新
                            </div>
                            <div click.delegate="historyHandler()" class="item">
                                <i class="history icon"></i> 历史
                            </div>
                            <div if.bind="isSuper || blog.creator.username == loginUser.username" click.delegate="authHandler()" class="item">
                                <i class="lock icon"></i> 限制
                            </div>
                            <div click.delegate="stowHandler()" class="item">
                                <i class="${!blogStow ? 'empty' : ''} star icon"></i> ${!blogStow ? '收藏' : '删除收藏'}
                            </div>
                            <div click.delegate="copyHandler()" class="item">
                                <i class="copy icon"></i> 复制
                            </div>
                            <div if.bind="isSuper || blog.creator.username == loginUser.username" click.delegate="updateSpaceHandler()" class="item">
                                <i class="exchange icon"></i> 移动
                            </div>
                            <div if.bind="isSuper || blog.creator.username == loginUser.username" click.delegate="openEditHandler()" class="item">
                                <i class="write icon"></i> ${blog.openEdit ? '关闭协作编辑' : '开放协作编辑'}
                            </div>
                            <div class="divider"></div>
                            <a href="/admin/blog/download/${blog.id}?type=pdf" class="item">
                                <i class="file pdf outline icon"></i> 导出为PDF
                            </a>
                            <a href="/admin/blog/download/${blog.id}?type=md" class="item">
                                <i class="file text outline icon"></i> 导出为Markdown
                            </a>
                            <div if.bind="isSuper || blog.creator.username == loginUser.username" class="divider"></div>
                            <div if.bind="isSuper || blog.creator.username == loginUser.username" click.delegate="deleteHandler()" class="item" style="color: red;">
                                <i class="trash outline icon"></i> 删除
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="header">
                <h1 class="ui header">${blog.title}
                <div class="sub header">
                    <i class="wait icon"></i> <a class="author" data-value="${blog.creator.username}">${blog.creator.username == loginUser.username ? '自己' : blog.creator.name}</a> 创建于 <span data-timeago="${blog.createDate}" title="${blog.createDate | date}">${blog.createDate | timeago}</span>, <a class="author" data-value="${blog.updater.username}">${blog.updater.username == loginUser.username ? '自己' : blog.updater.name}</a> 最后修改于 <span data-timeago="${blog.updateDate}" title="${blog.updateDate | date}">${blog.updateDate | timeago}</span>
                    <span class="readCnt" show.bind="blog.readCnt"><i class="unhide icon"></i>浏览: <a>${blog.readCnt}</a> 次</span>
                </div>
            </h1>
            </div>
            <div swipebox ref="mkbodyRef" class="markdown-body" innerhtml.bind="blog.content | parseMd | emoji:mkbodyRef"></div>
            <div class="footer">
                <span click.delegate="rateHandler()" class="rate"><i class="link icon thumbs outline up"></i>${blog.voteZan && blog.voteZan.split(',').includes(loginUser.username) ? '踩' : '赞'}</span> <span show.bind="!blog.voteZanCnt">成为第一个赞同者</span> <span show.bind="blog.voteZan && blog.voteZan.split(',').includes(loginUser.username)">你赞了它</span> <span show.bind="blog.voteZan && !blog.voteZan.split(',').includes(loginUser.username)" title="${blog.voteZan}"><a href="javascript:void(0);">${blog.voteZanCnt}</a>人赞了它</span>
            </div>
            <em-blog-comment blog.bind="blog"></em-blog-comment>
        </div>
        <div show.bind="!blog" class="em-blog-content">
            <div class="ui positive icon huge message transition">
                <i class="info circle icon"></i>
                <div class="content">
                    <div class="header">
                        欢迎使用TMS博文进行知识的分享总结!
                    </div>
                    <span>现在就去创建自己的博文吧!</span> <a click.delegate="createHandler()" class="ui mini blue button">创建</a>
                </div>
            </div>
        </div>
    </div>
    <div css="width: ${progressWidth}px;" class="tms-blog-progress"></div>
    <em-confirm-modal em-confirm-modal.ref="emConfirmModal"></em-confirm-modal>
    <em-blog-space-update view-model.ref="blogSpaceUpdateVm"></em-blog-space-update>
    <em-blog-history view-model.ref="blogHistoryVm"></em-blog-history>
    <em-blog-space-auth view-model.ref="blogSpaceAuthVm"></em-blog-space-auth>
</template>
